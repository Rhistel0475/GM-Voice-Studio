<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Co-DM — High Fantasy Edition</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;700;900&family=IM+Fell+English:ital@0;1&family=Caveat:wght@400;500;700&family=MedievalSharp&display=swap" rel="stylesheet" />
  <style>
    /* ─── Reset ─────────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* ─── Tokens ─────────────────────────────────────────────── */
    :root {
      --p-base:   #e8d8a8;
      --p-light:  #f4ead0;
      --p-mid:    #d8c490;
      --p-dark:   #c4aa70;
      --p-deep:   #a88a50;
      --ink:      #2e2010;
      --ink-lt:   #4a3420;
      --ink-faint:#7a6040;
      --gold:     #b8903c;
      --gold-lt:  #d4aa5a;
      --gold-glow:rgba(184,144,60,0.4);
      --red:      #7a2020;
      --red-lt:   #a03030;
      --blue:     #2a4060;
      --blue-lt:  #3a5880;
      --green:    #2a5020;
      --amber:    #7a5010;
      --shadow:   rgba(20,12,4,0.35);
      --shadow-d: rgba(20,12,4,0.60);
    }

    /* ─── Body ───────────────────────────────────────────────── */
    body {
      background: #0e0a06;
      background-image:
        radial-gradient(ellipse 80% 60% at 50% 0%,   #1c1408 0%, transparent 70%),
        radial-gradient(ellipse 60% 80% at 0%   50%,  #120e06 0%, transparent 60%),
        radial-gradient(ellipse 60% 80% at 100% 50%,  #0e0c10 0%, transparent 60%);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      font-family: 'IM Fell English', Georgia, serif;
      color: var(--ink);
      padding: 20px;
    }

    /* ─── Device shell ───────────────────────────────────────── */
    .device {
      width: 1160px;
      max-width: 100%;
      background: #1a1208;
      border-radius: 20px;
      padding: 10px;
      box-shadow:
        0 0 0 1px #2a1e0a,
        0 0 0 3px #0a0806,
        0 30px 80px rgba(0,0,0,0.85),
        inset 0 2px 4px rgba(255,255,255,0.04);
      position: relative;
    }
    /* Bezel corner rivets */
    .device::before, .device::after,
    .device > .rivet-br, .device > .rivet-bl {
      content: '◆';
      position: absolute;
      font-size: 10px;
      color: #5a4020;
      pointer-events: none;
    }
    .device::before  { top: 6px;  left: 8px;  }
    .device::after   { top: 6px;  right: 8px; }
    .device > .rivet-br { bottom: 6px; right: 8px; }
    .device > .rivet-bl { bottom: 6px; left: 8px;  }

    /* ─── Parchment screen ──────────────────────────────────── */
    .screen {
      border-radius: 12px;
      overflow: hidden;
      background: var(--p-base);
      background-image:
        /* paper grain */
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.07'/%3E%3C/svg%3E"),
        linear-gradient(170deg, var(--p-light) 0%, var(--p-base) 35%, var(--p-mid) 70%, var(--p-dark) 100%);
      display: flex;
      flex-direction: column;
      height: 720px;
      border: 1px solid var(--p-dark);
      box-shadow: inset 0 0 80px rgba(20,12,4,0.15);
    }

    /* ─── Scroll Header ─────────────────────────────────────── */
    .scroll-header {
      position: relative;
      background: linear-gradient(180deg, #1c1408 0%, #2c2010 50%, #1c1408 100%);
      border-bottom: 2px solid var(--gold);
      padding: 0 16px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      overflow: hidden;
    }
    /* Ornate left/right scroll ends */
    .scroll-header::before,
    .scroll-header::after {
      content: '';
      position: absolute;
      top: 0; bottom: 0;
      width: 40px;
      background: radial-gradient(ellipse at center, #3a2810 0%, #1c1408 100%);
      border: 1px solid var(--gold);
      opacity: 0.6;
    }
    .scroll-header::before { left: 0;  border-radius: 0 8px 8px 0; }
    .scroll-header::after  { right: 0; border-radius: 8px 0 0 8px; }

    .rune-strip {
      font-family: 'Cinzel', serif;
      font-size: 10px;
      letter-spacing: 5px;
      color: var(--gold);
      opacity: 0.55;
      z-index: 1;
      white-space: nowrap;
      padding: 0 48px;
    }
    .header-center {
      text-align: center;
      z-index: 1;
      flex: 0 0 auto;
    }
    .header-subtitle {
      font-family: 'Cinzel', serif;
      font-size: 9.5px;
      letter-spacing: 0.35em;
      color: var(--gold-lt);
      opacity: 0.8;
      text-transform: uppercase;
    }
    .header-title {
      font-family: 'Cinzel', serif;
      font-size: 22px;
      font-weight: 900;
      color: var(--gold);
      letter-spacing: 0.12em;
      line-height: 1.1;
      text-shadow: 0 0 16px var(--gold-glow), 0 2px 4px rgba(0,0,0,0.5);
    }
    .header-title em {
      font-style: normal;
      color: var(--gold-lt);
    }
    .header-emblem {
      display: inline-block;
      font-size: 13px;
      margin: 0 4px;
      vertical-align: middle;
      opacity: 0.7;
    }

    /* ─── Main Layout ───────────────────────────────────────── */
    .main {
      display: grid;
      grid-template-columns: 1.05fr 1.5fr 0.9fr;
      grid-template-rows: auto 1fr;
      flex: 1;
      overflow: hidden;
      min-height: 0;
    }

    /* ─── Campaign Banner (cols 1-2, row 1) ─────────────────── */
    .campaign-banner {
      grid-column: 1 / 3;
      grid-row: 1;
      border-bottom: 1px solid var(--p-dark);
      border-right: 1px solid var(--p-dark);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex-shrink: 0;
    }
    .campaign-title-bar {
      background: linear-gradient(90deg, #2a1c08 0%, #3a2a10 50%, #2a1c08 100%);
      padding: 6px 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      border-bottom: 1px solid var(--gold);
      flex-shrink: 0;
    }
    .campaign-label {
      font-family: 'Cinzel', serif;
      font-size: 9px;
      letter-spacing: 0.3em;
      color: var(--p-mid);
      opacity: 0.7;
    }
    .campaign-name {
      font-family: 'Cinzel', serif;
      font-size: 13px;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.15em;
      text-shadow: 0 0 8px var(--gold-glow);
    }

    /* Scene artwork */
    .scene-art {
      flex: 1;
      position: relative;
      overflow: hidden;
      min-height: 140px;
      background:
        linear-gradient(180deg,
          #8fa8c0 0%,
          #9bb0c4 15%,
          #b0c0d0 30%,
          #c8ccc0 50%,
          #b0a890 65%,
          #8a7860 80%,
          #6a5840 100%
        );
    }
    .scene-art svg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }
    .scene-caption {
      background: linear-gradient(90deg, #1e1408 0%, #2e2010 50%, #1e1408 100%);
      padding: 5px 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      border-top: 1px solid var(--gold);
      flex-shrink: 0;
    }
    .scene-caption-text {
      font-family: 'Cinzel', serif;
      font-size: 9px;
      letter-spacing: 0.25em;
      color: var(--p-mid);
      opacity: 0.8;
    }
    .caption-divider {
      width: 1px; height: 10px;
      background: var(--gold);
      opacity: 0.3;
    }

    /* ─── Party Roster (col 3, rows 1-2) ────────────────────── */
    .roster-panel {
      grid-column: 3;
      grid-row: 1 / 3;
      border-left: 2px solid var(--p-dark);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: linear-gradient(180deg, var(--p-light) 0%, var(--p-base) 100%);
    }
    .panel-chrome {
      background: linear-gradient(180deg, var(--ink) 0%, var(--ink-lt) 100%);
      color: var(--gold);
      font-family: 'Cinzel', serif;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.3em;
      text-align: center;
      padding: 7px 10px;
      border-bottom: 1px solid var(--gold);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-shrink: 0;
    }
    .panel-chrome .rune { opacity: 0.45; font-size: 12px; }

    .roster-scroll {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }

    /* Character cards — portrait style */
    .char-card {
      background: var(--p-light);
      border: 1px solid var(--p-dark);
      border-radius: 6px;
      padding: 7px 9px 7px 7px;
      display: flex;
      gap: 8px;
      align-items: flex-start;
      box-shadow: 0 2px 6px var(--shadow), inset 0 1px 0 rgba(255,255,255,0.4);
      cursor: pointer;
      transition: box-shadow 0.15s;
      position: relative;
    }
    .char-card:hover { box-shadow: 0 3px 10px var(--shadow-d); }
    .char-card::before {
      content: '';
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 3px;
      border-radius: 6px 0 0 6px;
      background: var(--gold);
    }
    .char-card.hurt::before  { background: var(--amber); }
    .char-card.low::before   { background: var(--red); }

    .portrait-frame {
      width: 38px; height: 38px;
      border-radius: 50%;
      border: 2px solid var(--p-dark);
      background: linear-gradient(145deg, var(--p-mid), var(--p-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
      box-shadow: 0 2px 5px var(--shadow), inset 0 1px 0 rgba(255,255,255,0.2);
      position: relative;
      overflow: hidden;
    }
    .portrait-frame.gold-border { border-color: var(--gold); }
    /* inner parchment ring */
    .portrait-frame::after {
      content: '';
      position: absolute;
      inset: 2px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.15);
      pointer-events: none;
    }

    .char-info { flex: 1; min-width: 0; }
    .char-name {
      font-family: 'Cinzel', serif;
      font-size: 11px;
      font-weight: 700;
      color: var(--ink);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .char-class {
      font-size: 10px;
      color: var(--ink-faint);
      font-style: italic;
      margin-bottom: 5px;
    }
    .char-status {
      display: flex;
      gap: 3px;
      align-items: center;
      flex-wrap: wrap;
    }
    .status-icon {
      font-size: 11px;
      line-height: 1;
      cursor: default;
    }
    .status-badge {
      font-family: 'Cinzel', serif;
      font-size: 8px;
      padding: 1px 4px;
      border-radius: 2px;
      letter-spacing: 0.05em;
    }
    .sb-hp  { background: rgba(42,80,32,0.12); color: var(--green); border: 1px solid rgba(42,80,32,0.3); }
    .sb-ac  { background: rgba(42,64,96,0.12); color: var(--blue);  border: 1px solid rgba(42,64,96,0.3); }
    .sb-bad { background: rgba(122,32,32,0.12); color: var(--red);  border: 1px solid rgba(122,32,32,0.3); }
    .sb-gold{ background: rgba(184,144,60,0.12); color: var(--gold); border: 1px solid rgba(184,144,60,0.3); }

    .hp-track {
      height: 4px;
      background: rgba(46,32,16,0.12);
      border-radius: 2px;
      margin-top: 5px;
      overflow: hidden;
    }
    .hp-fill {
      height: 100%;
      border-radius: 2px;
      transition: width 0.4s;
    }
    .hp-hi  { background: var(--green); }
    .hp-mid { background: var(--amber); }
    .hp-lo  { background: linear-gradient(90deg, var(--red), var(--red-lt)); }

    /* ─── World Map (bottom of roster column) ────────────────── */
    .map-section {
      flex-shrink: 0;
      border-top: 1px solid var(--p-dark);
    }
    .map-art {
      height: 126px;
      position: relative;
      overflow: hidden;
      background: linear-gradient(155deg, #c8b880 0%, #b8a870 30%, #a89860 60%, #c0b080 100%);
    }
    .map-art svg { position: absolute; inset: 0; width: 100%; height: 100%; }
    .map-pin {
      position: absolute;
      font-size: 14px;
      line-height: 1;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
    }
    .map-city-label {
      position: absolute;
      font-family: 'Caveat', cursive;
      font-size: 10px;
      color: var(--ink);
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
      white-space: nowrap;
    }
    .map-title {
      position: absolute;
      bottom: 4px; right: 6px;
      font-family: 'Cinzel', serif;
      font-size: 9px;
      color: var(--ink);
      letter-spacing: 0.1em;
      opacity: 0.7;
    }
    .map-footer {
      padding: 5px 8px;
      display: flex;
      gap: 4px;
      background: rgba(46,32,16,0.05);
      border-top: 1px solid var(--p-mid);
    }
    .map-btn {
      flex: 1;
      font-family: 'Cinzel', serif;
      font-size: 8px;
      letter-spacing: 0.08em;
      padding: 3px 4px;
      background: var(--p-mid);
      border: 1px solid var(--p-dark);
      border-radius: 2px;
      color: var(--ink);
      cursor: pointer;
      text-align: center;
      transition: all 0.15s;
    }
    .map-btn:hover { background: var(--ink); color: var(--gold); border-color: var(--gold); }

    /* ─── Left Column (col 1, row 2) ────────────────────────── */
    .left-col {
      grid-column: 1;
      grid-row: 2;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--p-dark);
      overflow: hidden;
    }

    /* Quick Tools */
    .quick-tools-section { border-bottom: 1px solid var(--p-dark); flex-shrink: 0; }
    .tools-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      padding: 9px;
    }
    .tool-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      padding: 10px 6px;
      background: var(--p-light);
      border: 1px solid var(--p-dark);
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 5px var(--shadow), inset 0 1px 0 rgba(255,255,255,0.5);
      transition: all 0.15s;
      text-align: center;
    }
    .tool-card:hover {
      background: var(--ink);
      color: var(--gold);
      border-color: var(--gold);
      box-shadow: 0 3px 8px var(--shadow-d);
    }
    .tool-card .t-icon { font-size: 22px; line-height: 1; }
    .tool-card .t-label {
      font-family: 'Cinzel', serif;
      font-size: 8.5px;
      letter-spacing: 0.08em;
      color: inherit;
    }
    .tool-card:hover .t-label { color: var(--gold); }
    .tool-card.danger:hover { background: var(--red); border-color: var(--red-lt); }
    .tool-card.magic:hover  { background: var(--blue); border-color: var(--blue-lt); }

    /* Session Notes */
    .notes-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .notes-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 8px;
      gap: 6px;
      overflow: hidden;
    }
    .notes-ta {
      flex: 1;
      font-family: 'Caveat', cursive;
      font-size: 13.5px;
      line-height: 1.75;
      color: var(--ink);
      background: transparent;
      border: none;
      resize: none;
      outline: none;
    }
    .notes-bar {
      display: flex;
      gap: 4px;
      align-items: center;
      flex-shrink: 0;
    }
    .tag-btn {
      font-family: 'Cinzel', serif;
      font-size: 8px;
      letter-spacing: 0.05em;
      padding: 2px 6px;
      border-radius: 2px;
      border: 1px solid;
      cursor: pointer;
      transition: all 0.15s;
      background: transparent;
    }
    .tag-quest  { color: var(--gold); border-color: var(--gold); }
    .tag-quest:hover  { background: var(--gold); color: var(--ink); }
    .tag-danger { color: var(--red);  border-color: var(--red);  }
    .tag-danger:hover { background: var(--red); color: var(--p-light); }
    .tag-lore   { color: var(--blue); border-color: var(--blue); }
    .tag-lore:hover   { background: var(--blue); color: var(--p-light); }
    .save-btn {
      margin-left: auto;
      font-family: 'Cinzel', serif;
      font-size: 8px;
      letter-spacing: 0.1em;
      padding: 3px 10px;
      background: var(--ink);
      color: var(--gold);
      border: 1px solid var(--gold);
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .save-btn:hover { background: var(--gold); color: var(--ink); }

    /* ─── Center Column (col 2, row 2) ──────────────────────── */
    .center-col {
      grid-column: 2;
      grid-row: 2;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--p-dark);
      overflow: hidden;
    }

    /* Encounter Tracker */
    .encounter-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-bottom: 1px solid var(--p-dark);
      overflow: hidden;
    }
    .encounter-chrome { background: linear-gradient(180deg, #2a1008 0%, #3a1c0c 100%); color: #f0c8a8; }
    .encounter-body {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    /* Initiative list */
    .init-panel {
      width: 120px;
      border-right: 1px solid var(--p-dark);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      overflow: hidden;
    }
    .init-header {
      font-family: 'Cinzel', serif;
      font-size: 8.5px;
      letter-spacing: 0.2em;
      color: var(--ink-faint);
      text-align: center;
      padding: 4px;
      border-bottom: 1px solid var(--p-mid);
      background: rgba(46,32,16,0.06);
      flex-shrink: 0;
    }
    .init-scroll { flex: 1; overflow-y: auto; }
    .init-row {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 4px 7px;
      border-bottom: 1px solid rgba(200,180,130,0.3);
      cursor: pointer;
      transition: background 0.1s;
    }
    .init-row:hover { background: rgba(184,144,60,0.07); }
    .init-row.on    { background: rgba(184,144,60,0.16); border-left: 3px solid var(--gold); padding-left: 4px; }
    .init-num { font-size: 9px; color: var(--ink-faint); width: 14px; flex-shrink: 0; font-family:'Cinzel',serif; }
    .init-roll {
      font-family: 'Cinzel', serif;
      font-size: 12px;
      font-weight: 700;
      color: var(--gold);
      width: 20px;
      text-align: right;
      flex-shrink: 0;
    }
    .init-name { font-size: 10px; flex: 1; color: var(--ink); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .init-dot  { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
    .init-row.enemy .init-roll { color: var(--red); }
    .init-row.enemy .init-name { color: var(--red-lt); }
    .init-controls {
      padding: 5px;
      display: flex;
      flex-direction: column;
      gap: 3px;
      border-top: 1px solid var(--p-mid);
      flex-shrink: 0;
    }
    .ic-btn {
      font-family: 'Cinzel', serif;
      font-size: 8px;
      letter-spacing: 0.05em;
      padding: 3px 4px;
      border-radius: 2px;
      border: 1px solid var(--p-dark);
      background: var(--p-base);
      color: var(--ink);
      cursor: pointer;
      text-align: center;
      transition: all 0.15s;
    }
    .ic-btn:hover { background: var(--ink); color: var(--gold); }
    .ic-btn.next { border-color: var(--gold); color: var(--gold); }
    .ic-btn.next:hover { background: var(--gold); color: var(--ink); }

    /* Battle grid */
    .grid-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: 7px;
      gap: 5px;
    }
    .battle-grid {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 2px;
      flex: 1;
    }
    .gcell {
      background: rgba(184,144,60,0.06);
      border: 1px solid rgba(184,144,60,0.18);
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.1s;
      aspect-ratio: 1;
    }
    .gcell:hover  { background: rgba(184,144,60,0.18); }
    .gcell.pc     { background: rgba(42,64,96,0.12);  border-color: var(--blue-lt); }
    .gcell.npc    { background: rgba(122,32,32,0.14); border-color: var(--red-lt); }
    .gcell.wall   { background: rgba(46,32,16,0.28);  border-color: var(--ink-faint); cursor: default; }
    .gcell.sel    { outline: 2px solid var(--gold); outline-offset: 1px; }
    .grid-toolbar {
      display: flex;
      gap: 4px;
      flex-shrink: 0;
    }
    .gt-btn {
      font-family: 'Cinzel', serif;
      font-size: 8px;
      letter-spacing: 0.05em;
      padding: 2px 7px;
      border-radius: 2px;
      border: 1px solid var(--p-dark);
      background: var(--p-light);
      color: var(--ink);
      cursor: pointer;
      transition: all 0.15s;
    }
    .gt-btn:hover   { background: var(--ink); color: var(--gold); border-color: var(--gold); }
    .gt-btn.active  { background: var(--gold); color: var(--ink); border-color: var(--gold-lt); }

    /* Spell Book Viewer */
    .spellbook-section {
      flex-shrink: 0;
      height: 155px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .spellbook-chrome { background: linear-gradient(180deg, #18142e 0%, #241e3e 100%); color: #c8b8f0; }
    .spellbook-body {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    .spell-slots-col {
      width: 100px;
      border-right: 1px solid var(--p-mid);
      padding: 6px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow-y: auto;
      flex-shrink: 0;
    }
    .slot-lbl {
      font-family: 'Cinzel', serif;
      font-size: 8px;
      color: var(--ink-faint);
      letter-spacing: 0.1em;
      margin-bottom: 2px;
    }
    .slot-row { display: flex; align-items: center; gap: 3px; }
    .slot-l   { font-family:'Cinzel',serif; font-size:8px; color:var(--ink-faint); width:26px; flex-shrink:0; }
    .pip {
      width: 8px; height: 8px;
      border-radius: 50%;
      border: 1px solid var(--blue);
      background: var(--blue);
      cursor: pointer;
      transition: background 0.1s;
    }
    .pip.spent { background: transparent; border-color: var(--p-dark); }
    .dc-val {
      font-family: 'Cinzel', serif;
      font-size: 20px;
      font-weight: 700;
      color: var(--blue);
      text-align: center;
      line-height: 1.1;
    }
    .dc-sub { font-size: 8px; color: var(--ink-faint); font-family:'Cinzel',serif; letter-spacing:0.05em; text-align:center; }

    /* Spell log entries (matches reference image: previous entries) */
    .spell-log { flex: 1; overflow-y: auto; padding: 6px 8px; display: flex; flex-direction: column; gap: 4px; }
    .spell-entry {
      border-bottom: 1px solid rgba(200,180,130,0.3);
      padding-bottom: 4px;
    }
    .spell-entry-head {
      display: flex;
      gap: 6px;
      align-items: baseline;
    }
    .spell-entry-name {
      font-family: 'IM Fell English', serif;
      font-size: 11px;
      font-weight: 700;
      color: var(--ink);
      font-style: italic;
    }
    .spell-entry-time {
      font-size: 9px;
      color: var(--ink-faint);
      margin-left: auto;
      white-space: nowrap;
    }
    .spell-entry-desc {
      font-size: 10px;
      color: var(--ink-lt);
      line-height: 1.5;
      margin-top: 1px;
    }

    /* ─── Footer Nav ─────────────────────────────────────────── */
    .app-footer {
      background: linear-gradient(0deg, #1c1408 0%, #2c2010 100%);
      border-top: 2px solid var(--gold);
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: space-around;
      flex-shrink: 0;
      padding: 0 8px;
    }
    .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      padding: 6px 16px;
      cursor: pointer;
      transition: all 0.15s;
      flex: 1;
      border: none;
      background: transparent;
      position: relative;
    }
    .nav-btn.on::before {
      content: '';
      position: absolute;
      top: 0; left: 15%; right: 15%;
      height: 2px;
      background: var(--gold);
      box-shadow: 0 0 6px var(--gold-glow);
    }
    .nav-btn:hover .nav-ico { transform: scale(1.12); }
    .nav-ico {
      font-size: 16px;
      transition: transform 0.15s;
      filter: drop-shadow(0 0 3px var(--gold-glow));
    }
    .nav-lbl {
      font-family: 'Cinzel', serif;
      font-size: 7.5px;
      letter-spacing: 0.15em;
      color: var(--p-mid);
      opacity: 0.65;
    }
    .nav-btn.on .nav-lbl { color: var(--gold); opacity: 1; }
    .nav-center {
      width: 50px; height: 50px;
      border-radius: 50%;
      background: radial-gradient(circle, #5a4020 0%, #2c1c08 100%);
      border: 2px solid var(--gold);
      box-shadow: 0 0 18px var(--gold-glow), 0 4px 10px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      top: -14px;
      flex-shrink: 0;
      margin: 0 6px;
      color: var(--gold);
      border: none;
      background: radial-gradient(circle, #6a5030 0%, #2c1c08 100%);
      border: 2px solid var(--gold);
    }
    .nav-center:hover {
      box-shadow: 0 0 28px rgba(184,144,60,0.7), 0 4px 14px rgba(0,0,0,0.5);
      transform: scale(1.05) translateY(-2px);
    }

    /* ─── Scrollbars ─────────────────────────────────────────── */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--p-dark); border-radius: 2px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--gold); }

    /* ─── Ink divider ────────────────────────────────────────── */
    .ink-div {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--p-dark), transparent);
      margin: 3px 0;
    }

    /* ─── HP bar widths ─────────────────────────────────────── */
    .hp-w-90 { width: 90%; }
    .hp-w-91 { width: 91%; }
    .hp-w-95 { width: 95%; }
    .hp-w-48 { width: 48%; }
    .hp-w-16 { width: 16%; }

    /* ─── Initiative dot colours ────────────────────────────── */
    .dot-green  { background: var(--green); }
    .dot-red    { background: var(--red); }
    .dot-amber  { background: var(--amber); }
    .dot-red-lt { background: var(--red-lt); }

    /* ─── Live session dot ──────────────────────────────────── */
    .live-dot {
      display: inline-block;
      width: 6px; height: 6px;
      background: #4a9a4a;
      border-radius: 50%;
      margin-right: 5px;
      vertical-align: middle;
      will-change: opacity;
      animation: blink 2s infinite;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

    /* ─── Scene caption highlight ───────────────────────────── */
    .caption-highlight { color: var(--gold-lt); opacity: 0.9; }

    /* ─── Compact panel chrome (world map header) ───────────── */
    .panel-chrome-sm { padding: 5px 10px; font-size: 9px; }

    /* ─── Map label positions ───────────────────────────────── */
    .map-lbl-1 { left: 8%;  top: 68%; }
    .map-lbl-2 { left: 44%; top: 38%; }
    .map-lbl-3 { left: 70%; top: 48%; }
    .map-lbl-4 { left: 30%; top: 78%; font-size: 9px; opacity: 0.7; }
    .map-pin-1 { left: 43%; top: 26%; }

    /* ─── SVG paladin transform-origin ─────────────────────── */
    .svg-centered { transform-origin: center; }

    /* ─── Initiative empty state ────────────────────────────── */
    .init-empty {
      padding: 18px 10px;
      text-align: center;
      font-family: 'Cinzel', serif;
      font-size: 10px;
      color: var(--ink-faint);
      letter-spacing: 0.1em;
    }

    /* ─── Portrait images ───────────────────────────────────── */
    .portrait-img { width: 100%; height: 100%; object-fit: cover; border-radius: inherit; }

    /* ─── SVG heart status icons ────────────────────────────── */
    .heart-icon { width: 14px; height: 14px; vertical-align: middle; display: inline-block; }
    .heart-red   { fill: #c44444; }
    .heart-amber { fill: #b88000; }
    .heart-dark  { fill: #555555; }

    /* ─── SVG tool card icons ────────────────────────────────── */
    .tool-icon { width: 28px; height: 28px; display: block; margin: 0 auto 4px; }

    /* ─── SVG map pin ────────────────────────────────────────── */
    .map-pin-svg { width: 12px; height: 16px; display: block; }

    /* ─── Photo tool cards ───────────────────────────────────── */
    .tool-icon-img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; border-radius: inherit; }
    .tool-card { position: relative; overflow: hidden; }
    .tool-card .t-label { position: relative; z-index: 1; background: rgba(20,12,4,0.6); padding: 2px 6px; border-radius: 3px; }
  </style>
</head>
<body>

<div class="device">
  <div class="rivet-br"></div>
  <div class="rivet-bl"></div>

  <div class="screen">

    <!-- ── Scroll Header ──────────────────────────────────────── -->
    <header class="scroll-header">
      <span class="rune-strip">ᚠ ᚢ ᚦ ᚨ ᚱ ᚲ ᚷ ᚹ ᚺ ᚾ</span>
      <div class="header-center">
        <div class="header-subtitle">High Fantasy D&amp;D</div>
        <div class="header-title">
          <span class="header-emblem">⚜</span>
          Co-<em>DM</em> Edition
          <span class="header-emblem">⚜</span>
        </div>
      </div>
      <span class="rune-strip">ᛁ ᛃ ᛇ ᛈ ᛉ ᛊ ᛏ ᛒ ᛖ ᛗ</span>
    </header>

    <!-- ── Main Grid ───────────────────────────────────────────── -->
    <div class="main">

      <!-- Campaign Banner -->
      <div class="campaign-banner">
        <div class="campaign-title-bar">
          <span class="campaign-label">CURRENT CAMPAIGN:</span>
          <span class="campaign-name">THE SHATTERED CROWN</span>
        </div>

        <!-- Scene artwork: SVG adventurer silhouettes -->
        <div class="scene-art">
          <svg viewBox="0 0 760 170" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="sky" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%"   stop-color="#6080a0"/>
                <stop offset="40%"  stop-color="#8098b8"/>
                <stop offset="70%"  stop-color="#a0b0c0"/>
                <stop offset="100%" stop-color="#b8b0a0"/>
              </linearGradient>
              <linearGradient id="fog" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%"  stop-color="#c8d0d8" stop-opacity="0.0"/>
                <stop offset="100%" stop-color="#d8d0c0" stop-opacity="0.55"/>
              </linearGradient>
              <filter id="blur"><feGaussianBlur stdDeviation="2"/></filter>
              <filter id="blur2"><feGaussianBlur stdDeviation="1"/></filter>
            </defs>

            <!-- Sky -->
            <rect width="760" height="170" fill="url(#sky)"/>

            <!-- Distant mountains (far) -->
            <polygon points="0,140 60,60 120,140"  fill="#7a8898" opacity="0.4" filter="url(#blur)"/>
            <polygon points="50,140 130,45 210,140" fill="#6a7888" opacity="0.35" filter="url(#blur)"/>
            <polygon points="140,140 210,30 280,140" fill="#788898" opacity="0.4" filter="url(#blur)"/>
            <polygon points="220,140 290,55 360,140" fill="#6e7e8e" opacity="0.3" filter="url(#blur)"/>
            <polygon points="300,140 375,25 450,140" fill="#788898" opacity="0.38" filter="url(#blur)"/>
            <polygon points="380,140 460,50 540,140" fill="#6a7888" opacity="0.3" filter="url(#blur)"/>
            <polygon points="460,140 540,35 620,140" fill="#788898" opacity="0.35" filter="url(#blur)"/>
            <polygon points="550,140 630,60 700,140" fill="#6e7e90" opacity="0.3" filter="url(#blur)"/>
            <polygon points="640,140 700,45 760,140" fill="#788898" opacity="0.35" filter="url(#blur)"/>

            <!-- Ruined castle / citadel (background right) -->
            <g opacity="0.45" filter="url(#blur2)" transform="translate(520, 40)">
              <rect x="0"  y="60" width="14" height="60" fill="#4a4a50"/>
              <rect x="16" y="40" width="20" height="80" fill="#5a5a60"/>
              <rect x="38" y="55" width="14" height="65" fill="#4a4a50"/>
              <!-- battlements -->
              <rect x="0"  y="56" width="4"  height="6" fill="#4a4a50"/>
              <rect x="6"  y="56" width="4"  height="6" fill="#4a4a50"/>
              <rect x="10" y="56" width="4"  height="6" fill="#4a4a50"/>
              <rect x="16" y="36" width="5"  height="7" fill="#5a5a60"/>
              <rect x="23" y="36" width="5"  height="7" fill="#5a5a60"/>
              <rect x="30" y="36" width="5"  height="7" fill="#5a5a60"/>
              <!-- tower window -->
              <rect x="20" y="52" width="10" height="14" fill="#202040" rx="2"/>
              <!-- broken wall -->
              <polygon points="52,100 60,75 70,65 80,70 85,100" fill="#5a5860" opacity="0.7"/>
            </g>

            <!-- Dead/bare tree (far left) -->
            <g opacity="0.35" filter="url(#blur2)" transform="translate(30,60)">
              <rect x="4" y="40" width="3" height="60" fill="#3a2a1a"/>
              <line x1="5.5" y1="55" x2="-6"  y2="42" stroke="#3a2a1a" stroke-width="2"/>
              <line x1="5.5" y1="62" x2="18"  y2="50" stroke="#3a2a1a" stroke-width="1.5"/>
              <line x1="5.5" y1="70" x2="-4"  y2="65" stroke="#3a2a1a" stroke-width="1.5"/>
              <line x1="5.5" y1="75" x2="14"  y2="72" stroke="#3a2a1a" stroke-width="1.5"/>
            </g>

            <!-- Ground plane -->
            <ellipse cx="380" cy="175" rx="440" ry="60" fill="#8a7858" opacity="0.6"/>
            <rect x="0" y="150" width="760" height="30" fill="#7a6848" opacity="0.7"/>

            <!-- Path / road -->
            <path d="M 200,175 Q 350,140 500,145 Q 600,148 660,160 L 760,170 L 0,170 Z"
                  fill="#a09070" opacity="0.4"/>

            <!-- Fog layer -->
            <rect width="760" height="170" fill="url(#fog)"/>

            <!-- ── Adventurer silhouettes ── -->
            <!-- 1: Wizard (staff, robes, pointed hat) -->
            <g transform="translate(180,90)" opacity="0.88">
              <rect x="0" y="12" width="12" height="28" rx="2" fill="#1e1408"/>
              <!-- robe -->
              <polygon points="-3,24 15,24 18,55 -6,55" fill="#1e1408"/>
              <!-- head -->
              <ellipse cx="6" cy="10" rx="6" ry="7" fill="#1e1408"/>
              <!-- pointed hat -->
              <polygon points="0,4 12,4 7,-14" fill="#1e1408"/>
              <rect x="0" y="2" width="12" height="3" fill="#1e1408"/>
              <!-- staff -->
              <rect x="-8" y="-8" width="2" height="68" fill="#2a1a08" rx="1"/>
              <ellipse cx="-7" cy="-10" rx="4" ry="4" fill="#3a2810"/>
            </g>

            <!-- 2: Ranger/archer (bow, quiver) -->
            <g transform="translate(240,95)" opacity="0.88">
              <rect x="0" y="10" width="11" height="25" rx="1" fill="#1a1208"/>
              <!-- legs -->
              <rect x="0"  y="33" width="5" height="22" rx="1" fill="#1a1208"/>
              <rect x="6"  y="33" width="5" height="22" rx="1" fill="#1a1208"/>
              <!-- head -->
              <ellipse cx="5.5" cy="7" rx="5.5" ry="6" fill="#1a1208"/>
              <!-- hood -->
              <path d="M 0,4 Q 5.5,-4 11,4" fill="#1a1208"/>
              <!-- bow -->
              <path d="M 15,2 Q 22,10 15,28" stroke="#2a1a08" stroke-width="2" fill="none"/>
              <line x1="15" y1="2" x2="15" y2="28" stroke="#1a0e04" stroke-width="1"/>
              <!-- quiver on back -->
              <rect x="-6" y="6" width="4" height="14" rx="1" fill="#2a1a08"/>
            </g>

            <!-- 3: Paladin/fighter (armored, shield) — center, slightly larger -->
            <g transform="translate(305,82)" opacity="0.9" class="svg-centered">
              <!-- body armor -->
              <rect x="-1" y="14" width="16" height="28" rx="2" fill="#181008"/>
              <!-- pauldrons -->
              <rect x="-5" y="12" width="6" height="8" rx="2" fill="#181008"/>
              <rect x="13" y="12" width="6" height="8" rx="2" fill="#181008"/>
              <!-- legs -->
              <rect x="0"  y="40" width="6" height="26" rx="1" fill="#181008"/>
              <rect x="8"  y="40" width="6" height="26" rx="1" fill="#181008"/>
              <!-- head / helm -->
              <rect x="0" y="0" width="14" height="14" rx="3" fill="#181008"/>
              <!-- visor slit -->
              <rect x="2" y="6" width="10" height="2" fill="#302010" opacity="0.7"/>
              <!-- plume -->
              <path d="M 7,0 Q 4,-12 8,-18 Q 12,-12 7,0" fill="#1e1408"/>
              <!-- shield (left arm) -->
              <path d="M -14,14 L -6,14 L -6,38 Q -10,42 -14,38 Z" fill="#1e1008"/>
              <line x1="-10" y1="14" x2="-10" y2="40" stroke="#2a1808" stroke-width="1" opacity="0.5"/>
              <!-- sword (right arm raised) -->
              <rect x="18" y="-6" width="3" height="36" rx="1" fill="#1a1208" transform="rotate(-18,20,15)"/>
              <rect x="13" y="14" width="12" height="3" rx="1" fill="#1a1208"/>
            </g>

            <!-- 4: Rogue (crouching slightly, daggers) -->
            <g transform="translate(365,100)" opacity="0.85">
              <rect x="0" y="10" width="10" height="22" rx="1" fill="#141008"/>
              <!-- legs (one bent) -->
              <rect x="0"  y="30" width="5" height="18" rx="1" fill="#141008"/>
              <rect x="5"  y="30" width="5" height="16" rx="1" fill="#141008" transform="rotate(8,8,30)"/>
              <!-- head -->
              <ellipse cx="5" cy="7" rx="5" ry="6" fill="#141008"/>
              <!-- hood/mask -->
              <path d="M 0,5 Q 5,-2 10,5" fill="#141008"/>
              <rect x="1" y="7" width="8" height="3" fill="#141008"/>
              <!-- dagger right -->
              <rect x="12" y="18" width="2" height="14" rx="1" fill="#1a1208" transform="rotate(-20,13,25)"/>
              <!-- dagger left -->
              <rect x="-4" y="18" width="2" height="12" rx="1" fill="#1a1208" transform="rotate(20,-3,24)"/>
            </g>

            <!-- 5: Cleric (holy symbol, robes) -->
            <g transform="translate(420,93)" opacity="0.85">
              <rect x="0" y="12" width="12" height="26" rx="2" fill="#1a1210"/>
              <!-- robe skirt -->
              <polygon points="-2,24 14,24 16,55 -4,55" fill="#1a1210"/>
              <!-- head -->
              <ellipse cx="6" cy="9" rx="6" ry="7" fill="#1a1210"/>
              <!-- coif/hood -->
              <path d="M -1,5 Q 6,-3 13,5 L 13,12 L -1,12 Z" fill="#1a1210"/>
              <!-- staff / holy symbol -->
              <rect x="14" y="-2" width="2" height="62" rx="1" fill="#1e1410"/>
              <!-- cross -->
              <rect x="10" y="-5" width="10" height="2" rx="1" fill="#1e1410"/>
              <rect x="14" y="-8" width="2" height="10" rx="1" fill="#1e1410"/>
              <!-- book in other arm -->
              <rect x="-8" y="18" width="8" height="10" rx="1" fill="#1e1410"/>
            </g>

            <!-- Ambient: crows/birds in sky -->
            <g fill="none" stroke="#2a3040" stroke-width="1.5" opacity="0.4">
              <path d="M100,30 Q103,26 107,30"/>
              <path d="M115,22 Q118,18 122,22"/>
              <path d="M600,35 Q603,31 607,35"/>
              <path d="M620,28 Q623,24 627,28"/>
              <path d="M640,40 Q643,36 647,40"/>
            </g>
          </svg>
        </div>

        <div class="scene-caption">
          <span class="scene-caption-text">NEXT SESSION: 2 DAYS AWAY</span>
          <div class="caption-divider"></div>
          <span class="scene-caption-text caption-highlight">THE SUNKEN TEMPLE</span>
          <div class="caption-divider"></div>
          <span class="scene-caption-text"><span class="live-dot"></span>SESSION ACTIVE</span>
        </div>
      </div><!-- /.campaign-banner -->

      <!-- ── Party Roster (right, rows 1-2) ──────────────────── -->
      <div class="roster-panel">
        <div class="panel-chrome">
          <span class="rune">ᚨ</span>
          PARTY ROSTER
          <span class="rune">ᚨ</span>
        </div>
        <div class="roster-scroll">

          <!-- Aethelred -->
          <div class="char-card">
            <div class="portrait-frame gold-border"><img src="/static/img/portraits/aethelred.jpg" onerror="this.src='https://api.dicebear.com/9.x/adventurer/svg?seed=Aethelred&amp;backgroundColor=d4aa5a,b8903c&amp;backgroundType=gradientLinear'" class="portrait-img" alt="Aethelred" /></div>
            <div class="char-info">
              <div class="char-name">Aethelred</div>
              <div class="char-class">Human · Paladin · Lv 8</div>
              <div class="char-status">
                <span class="status-icon"><svg viewBox="0 0 24 24" class="heart-icon heart-red" aria-hidden="true"><path d="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402z"/></svg></span>
                <span class="status-badge sb-hp">72/80</span>
                <span class="status-badge sb-ac">AC 18</span>
                <span class="status-badge sb-gold">CONC</span>
              </div>
              <div class="hp-track"><div class="hp-fill hp-hi hp-w-90"></div></div>
            </div>
          </div>

          <!-- Lira -->
          <div class="char-card hurt">
            <div class="portrait-frame"><img src="/static/img/portraits/lira.jpg" onerror="this.src='https://api.dicebear.com/9.x/adventurer/svg?seed=Lira&amp;backgroundColor=2a1a08,1a1008&amp;backgroundType=gradientLinear'" class="portrait-img" alt="Lira" /></div>
            <div class="char-info">
              <div class="char-name">Lira</div>
              <div class="char-class">Half-Elf · Rogue · Lv 8</div>
              <div class="char-status">
                <span class="status-icon"><svg viewBox="0 0 24 24" class="heart-icon heart-amber" aria-hidden="true"><path d="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402z"/></svg></span>
                <span class="status-badge sb-hp">28/58</span>
                <span class="status-badge sb-ac">AC 15</span>
                <span class="status-badge sb-bad">INJURED</span>
              </div>
              <div class="hp-track"><div class="hp-fill hp-mid hp-w-48"></div></div>
            </div>
          </div>

          <!-- Torin -->
          <div class="char-card">
            <div class="portrait-frame"><img src="/static/img/portraits/torin.jpg" onerror="this.src='https://api.dicebear.com/9.x/adventurer/svg?seed=Torin&amp;backgroundColor=2a4060,1a2840&amp;backgroundType=gradientLinear'" class="portrait-img" alt="Torin" /></div>
            <div class="char-info">
              <div class="char-name">Torin</div>
              <div class="char-class">Gnome · Wizard · Lv 8</div>
              <div class="char-status">
                <span class="status-icon"><svg viewBox="0 0 24 24" class="heart-icon heart-red" aria-hidden="true"><path d="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402z"/></svg></span>
                <span class="status-badge sb-hp">40/44</span>
                <span class="status-badge sb-ac">AC 13</span>
              </div>
              <div class="hp-track"><div class="hp-fill hp-hi hp-w-91"></div></div>
            </div>
          </div>

          <!-- Zephyr -->
          <div class="char-card low">
            <div class="portrait-frame"><img src="/static/img/portraits/zephyr.jpg" onerror="this.src='https://api.dicebear.com/9.x/adventurer/svg?seed=Zephyr&amp;backgroundColor=2a5020,1a3810&amp;backgroundType=gradientLinear'" class="portrait-img" alt="Zephyr" /></div>
            <div class="char-info">
              <div class="char-name">Zephyr</div>
              <div class="char-class">Wood Elf · Druid · Lv 8</div>
              <div class="char-status">
                <span class="status-icon"><svg viewBox="0 0 24 24" class="heart-icon heart-dark" aria-hidden="true"><path d="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402z"/></svg></span>
                <span class="status-badge sb-hp">9/56</span>
                <span class="status-badge sb-ac">AC 14</span>
                <span class="status-badge sb-bad">PRONE</span>
              </div>
              <div class="hp-track"><div class="hp-fill hp-lo hp-w-16"></div></div>
            </div>
          </div>

          <!-- Mira -->
          <div class="char-card">
            <div class="portrait-frame"><img src="/static/img/portraits/mira.jpg" onerror="this.src='https://api.dicebear.com/9.x/adventurer/svg?seed=Mira&amp;backgroundColor=c8b070,a88a50&amp;backgroundType=gradientLinear'" class="portrait-img" alt="Mira" /></div>
            <div class="char-info">
              <div class="char-name">Mira</div>
              <div class="char-class">Human · Cleric · Lv 8</div>
              <div class="char-status">
                <span class="status-icon"><svg viewBox="0 0 24 24" class="heart-icon heart-red" aria-hidden="true"><path d="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402z"/></svg></span>
                <span class="status-badge sb-hp">52/55</span>
                <span class="status-badge sb-ac">AC 17</span>
              </div>
              <div class="hp-track"><div class="hp-fill hp-hi hp-w-95"></div></div>
            </div>
          </div>

          <div class="ink-div"></div>

        </div><!-- /.roster-scroll -->

        <!-- World Map -->
        <div class="map-section">
          <div class="panel-chrome panel-chrome-sm">
            <span class="rune">ᛗ</span> WORLD MAP <span class="rune">ᛗ</span>
          </div>
          <div class="map-art">
            <svg viewBox="0 0 250 120" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <filter id="pap"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/><feBlend in="SourceGraphic" mode="multiply" result="blend"/></filter>
              </defs>
              <!-- Parchment base -->
              <rect width="250" height="120" fill="#c8b070" opacity="0.5"/>
              <!-- Ocean area -->
              <path d="M170,70 Q200,80 250,90 L250,120 L170,120 Z" fill="#7090a0" opacity="0.35"/>
              <!-- Mountains left -->
              <polygon points="0,100 20,55 40,100"  fill="#8a7858" opacity="0.6"/>
              <polygon points="25,100 45,45 65,100" fill="#9a8868" opacity="0.55"/>
              <polygon points="50,100 65,60 80,100" fill="#8a7858" opacity="0.5"/>
              <!-- Forest center -->
              <ellipse cx="120" cy="70" rx="18" ry="12" fill="#4a6a3a" opacity="0.55"/>
              <ellipse cx="138" cy="66" rx="16" ry="13" fill="#3a5a2a" opacity="0.5"/>
              <ellipse cx="155" cy="72" rx="14" ry="11" fill="#4a6a3a" opacity="0.45"/>
              <!-- River -->
              <path d="M0,75 Q50,65 90,78 Q130,90 170,72 Q210,54 250,60" stroke="#5080a0" stroke-width="2" fill="none" opacity="0.5"/>
              <!-- Roads -->
              <path d="M30,110 Q80,90 125,82 Q170,74 210,88" stroke="#a09060" stroke-width="1.5" fill="none" opacity="0.5" stroke-dasharray="4,3"/>
              <!-- City dots -->
              <circle cx="45"  cy="108" r="3.5" fill="#7a2020" opacity="0.8"/>
              <circle cx="125" cy="82"  r="3"   fill="#2a4060" opacity="0.8"/>
              <circle cx="195" cy="65"  r="3.5" fill="#7a2020" opacity="0.8"/>
              <circle cx="100" cy="55"  r="2.5" fill="#5a4020" opacity="0.7"/>
              <!-- Citadel icon (SVG castle) -->
              <g transform="translate(111,32)" fill="#3a2810" opacity="0.8">
                <!-- main tower -->
                <rect x="4" y="5" width="6" height="8"/>
                <!-- battlements main -->
                <rect x="3" y="3" width="2" height="3"/>
                <rect x="6.5" y="3" width="2" height="3"/>
                <rect x="10" y="3" width="2" height="3"/>
                <!-- left turret -->
                <rect x="0" y="7" width="4" height="6"/>
                <rect x="-1" y="5" width="2" height="3"/>
                <rect x="2" y="5" width="2" height="3"/>
                <!-- right turret -->
                <rect x="10" y="7" width="4" height="6"/>
                <rect x="10" y="5" width="2" height="3"/>
                <rect x="13" y="5" width="2" height="3"/>
                <!-- gate arch -->
                <path d="M5.5,13 Q7,10.5 8.5,13 Z"/>
                <rect x="5.5" y="11.5" width="3" height="1.5"/>
              </g>
            </svg>
            <!-- Labels -->
            <div class="map-city-label map-lbl-1">Greyhaven</div>
            <div class="map-city-label map-lbl-2">Shattered Crown</div>
            <div class="map-city-label map-lbl-3">Sea Port</div>
            <div class="map-city-label map-lbl-4">Fantasy City</div>
            <div class="map-pin map-pin-1"><svg viewBox="0 0 12 16" class="map-pin-svg" aria-hidden="true"><path d="M6 0C3.24 0 1 2.24 1 5c0 3.75 5 11 5 11s5-7.25 5-11C11 2.24 8.76 0 6 0zm0 7.5C4.62 7.5 3.5 6.38 3.5 5S4.62 2.5 6 2.5 8.5 3.62 8.5 5 7.38 7.5 6 7.5z" fill="#7a2020"/></svg></div>
            <div class="map-title">The Shattered Crown</div>
          </div>
          <div class="map-footer">
            <div class="map-btn">World</div>
            <div class="map-btn">Region</div>
            <div class="map-btn">Dungeon</div>
            <div class="map-btn">Travel</div>
          </div>
        </div>
      </div><!-- /.roster-panel -->

      <!-- ── Left Column ──────────────────────────────────────── -->
      <div class="left-col">

        <!-- Quick Tools -->
        <div class="quick-tools-section">
          <div class="panel-chrome">
            <span class="rune">⚔</span> QUICK TOOLS <span class="rune">⚔</span>
          </div>
          <div class="tools-grid">
            <div class="tool-card" onclick="rollDice(20)">
              <img src="/static/img/tools/dice.jpg" class="tool-icon-img" alt="" onerror="this.style.display='none'" />
              <span class="t-label">Roll Dice</span>
            </div>
            <div class="tool-card" onclick="alert('Monster Bestiary')">
              <img src="/static/img/tools/bestiary.jpg" class="tool-icon-img" alt="" onerror="this.style.display='none'" />
              <span class="t-label">Monster Bestiary</span>
            </div>
            <div class="tool-card magic" onclick="alert('Spell Reference')">
              <img src="/static/img/tools/bluff.jpg" class="tool-icon-img" alt="" onerror="this.style.display='none'" />
              <span class="t-label">Spell Ref</span>
            </div>
            <div class="tool-card" onclick="alert('Random NPC generated!')">
              <img src="/static/img/tools/npc.jpg" class="tool-icon-img" alt="" onerror="this.style.display='none'" />
              <span class="t-label">Gen NPC</span>
            </div>
            <div class="tool-card" onclick="alert('Loot table')">
              <img src="/static/img/tools/loot.jpg" class="tool-icon-img" alt="" onerror="this.style.display='none'" />
              <span class="t-label">Loot Table</span>
            </div>
            <div class="tool-card danger" onclick="applyDamage()">
              <img src="/static/img/tools/damage.jpg" class="tool-icon-img" alt="" onerror="this.style.display='none'" />
              <span class="t-label">Apply Damage</span>
            </div>
          </div>
        </div>

        <!-- Session Notes -->
        <div class="notes-section">
          <div class="panel-chrome">
            <span class="rune">ᛊ</span> SESSION NOTES <span class="rune">ᛊ</span>
          </div>
          <div class="notes-body">
            <textarea class="notes-ta" id="notesTA" placeholder="Scribe your notes here...">Session notes and into a calligraphy with ties, d10, d20n the diestines, d10 next of a session calligraphy.

— Party entered The Sunken Temple. Zephyr went down from a Beholder eye ray (DEX save, fail). Aethelred used Lay on Hands.

Next: Inner Sanctum. Expect guardian golems (CR 10).</textarea>
            <div class="notes-bar">
              <button type="button" class="tag-btn tag-quest" onclick="insertTag('QUEST:')">Quest</button>
              <button type="button" class="tag-btn tag-danger" onclick="insertTag('DANGER:')">Danger</button>
              <button type="button" class="tag-btn tag-lore" onclick="insertTag('LORE:')">Lore</button>
              <button type="button" class="save-btn" onclick="saveNotes(this)">Save</button>
            </div>
          </div>
        </div>

      </div><!-- /.left-col -->

      <!-- ── Center Column ───────────────────────────────────── -->
      <div class="center-col">

        <!-- Encounter Tracker -->
        <div class="encounter-section">
          <div class="panel-chrome encounter-chrome">
            <span class="rune">⚔</span>
            ENCOUNTER TRACKER
            <span class="rune">⚔</span>
          </div>
          <div class="encounter-body">

            <!-- Initiative -->
            <div class="init-panel">
              <div class="init-header">⚔ INITIATIVE</div>
              <div class="init-scroll" id="initList">
                <div class="init-row on" onclick="selectInit(this)">
                  <span class="init-num">1</span>
                  <span class="init-roll">22</span>
                  <span class="init-name">Aethelred</span>
                  <span class="init-dot dot-green"></span>
                </div>
                <div class="init-row enemy" onclick="selectInit(this)">
                  <span class="init-num">2</span>
                  <span class="init-roll">19</span>
                  <span class="init-name">Beholder</span>
                  <span class="init-dot dot-red"></span>
                </div>
                <div class="init-row" onclick="selectInit(this)">
                  <span class="init-num">3</span>
                  <span class="init-roll">17</span>
                  <span class="init-name">Torin</span>
                  <span class="init-dot dot-green"></span>
                </div>
                <div class="init-row" onclick="selectInit(this)">
                  <span class="init-num">4</span>
                  <span class="init-roll">15</span>
                  <span class="init-name">Mira</span>
                  <span class="init-dot dot-green"></span>
                </div>
                <div class="init-row enemy" onclick="selectInit(this)">
                  <span class="init-num">5</span>
                  <span class="init-roll">13</span>
                  <span class="init-name">Eye Tyrant</span>
                  <span class="init-dot dot-red"></span>
                </div>
                <div class="init-row" onclick="selectInit(this)">
                  <span class="init-num">6</span>
                  <span class="init-roll">11</span>
                  <span class="init-name">Lira</span>
                  <span class="init-dot dot-amber"></span>
                </div>
                <div class="init-row" onclick="selectInit(this)">
                  <span class="init-num">7</span>
                  <span class="init-roll">6</span>
                  <span class="init-name">Zephyr</span>
                  <span class="init-dot dot-red-lt"></span>
                </div>
              </div>
              <div class="init-controls">
                <button type="button" class="ic-btn next" onclick="nextInit()">▶ NEXT</button>
                <button type="button" class="ic-btn" onclick="addInit()">+ ADD</button>
                <button type="button" class="ic-btn" onclick="endCombat()">⏹ END</button>
              </div>
            </div>

            <!-- Battle Grid -->
            <div class="grid-panel">
              <div class="battle-grid" id="battleGrid"></div>
              <div class="grid-toolbar">
                <button type="button" class="gt-btn active" onclick="setTool(this,'move')">Move</button>
                <button type="button" class="gt-btn" onclick="setTool(this,'place')">Place</button>
                <button type="button" class="gt-btn" onclick="setTool(this,'wall')">Wall</button>
                <button type="button" class="gt-btn" onclick="clearGrid()">Clear</button>
              </div>
            </div>

          </div>
        </div><!-- /.encounter-section -->

        <!-- Spell Book Viewer -->
        <div class="spellbook-section">
          <div class="panel-chrome spellbook-chrome">
            <span class="rune">✦</span>
            SPELL BOOK VIEWER — TORIN
            <span class="rune">✦</span>
          </div>
          <div class="spellbook-body">

            <!-- Slot tracker -->
            <div class="spell-slots-col">
              <div class="slot-lbl">SPELL SLOTS</div>
              <div class="slot-row"><span class="slot-l">Lv 1</span><span class="pip"></span><span class="pip"></span><span class="pip spent"></span><span class="pip spent"></span></div>
              <div class="slot-row"><span class="slot-l">Lv 2</span><span class="pip"></span><span class="pip spent"></span><span class="pip spent"></span></div>
              <div class="slot-row"><span class="slot-l">Lv 3</span><span class="pip"></span><span class="pip"></span><span class="pip spent"></span></div>
              <div class="slot-row"><span class="slot-l">Lv 4</span><span class="pip"></span><span class="pip spent"></span></div>
              <div class="slot-row"><span class="slot-l">Lv 5</span><span class="pip"></span></div>
              <div class="ink-div"></div>
              <div class="slot-lbl">SPELL DC</div>
              <div class="dc-val">16</div>
              <div class="dc-sub">ATK +8</div>
            </div>

            <!-- Spell log — matches reference image format -->
            <div class="spell-log">
              <div class="spell-entry">
                <div class="spell-entry-head">
                  <span class="spell-entry-name">Previous Entries</span>
                  <span class="spell-entry-time">36 min ago</span>
                </div>
                <div class="spell-entry-desc">The spells sheo at one who the twe list suf the Shattered fees.</div>
              </div>
              <div class="spell-entry">
                <div class="spell-entry-head">
                  <span class="spell-entry-name">Previous Entries 2</span>
                  <span class="spell-entry-time">36 min ago</span>
                </div>
                <div class="spell-entry-desc">My wear the overin plan ovared in the mining strats insis.</div>
              </div>
              <div class="spell-entry">
                <div class="spell-entry-head">
                  <span class="spell-entry-name">Fireball — 3rd Level</span>
                  <span class="spell-entry-time">12 min ago</span>
                </div>
                <div class="spell-entry-desc">Cast at the Beholder cluster. DC 16 DEX save. 28 dmg (8d6). Two cultists failed.</div>
              </div>
              <div class="spell-entry">
                <div class="spell-entry-head">
                  <span class="spell-entry-name">Shield — Reaction</span>
                  <span class="spell-entry-time">4 min ago</span>
                </div>
                <div class="spell-entry-desc">Used reaction to deflect ray of disintegration. AC raised to 18. Slot expended.</div>
              </div>
            </div>

          </div>
        </div><!-- /.spellbook-section -->

      </div><!-- /.center-col -->

    </div><!-- /.main -->

    <!-- ── Footer Nav ─────────────────────────────────────────── -->
    <footer class="app-footer">
      <button type="button" class="nav-btn on">
        <span class="nav-ico"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true"><path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9.5z"/><path d="M9 21V12h6v9"/></svg></span>
        <span class="nav-lbl">DASHBOARD</span>
      </button>
      <button type="button" class="nav-btn">
        <span class="nav-ico"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="8" y1="13" x2="16" y2="13"/><line x1="8" y1="17" x2="12" y2="17"/></svg></span>
        <span class="nav-lbl">CAMPAIGNS</span>
      </button>
      <button type="button" class="nav-center" title="Co-GM">ᚱ</button>
      <button type="button" class="nav-btn">
        <span class="nav-ico"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></span>
        <span class="nav-lbl">LIBRARY</span>
      </button>
      <button type="button" class="nav-btn">
        <span class="nav-ico"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span>
        <span class="nav-lbl">SETTINGS</span>
      </button>
    </footer>

  </div><!-- /.screen -->
</div><!-- /.device -->

<script>
/* ── Battle Grid ────────────────────────────────────────── */
const ROWS = 6, COLS = 9;
const TOKENS = {
  2:'Pal', 11:'Rog', 19:'Wiz', 28:'Clr', 38:'Drd',  // PCs
  5:'Eye', 14:'Beh',                                  // Enemies
  8:'▪', 17:'▪', 26:'▪',                              // walls
  24:'≈', 25:'≈',                                     // water
};
const CLS = { 'Eye':'npc','Beh':'npc','▪':'wall','≈':'wall' };
let gridTool = 'move', sel = null;

function buildGrid() {
  const g = document.getElementById('battleGrid');
  g.innerHTML = '';
  for (let i = 0; i < ROWS * COLS; i++) {
    const c = document.createElement('div');
    c.className = 'gcell';
    const t = TOKENS[i];
    if (t) {
      c.textContent = t;
      c.classList.add(CLS[t] || 'pc');
    }
    c.dataset.i = i;
    c.addEventListener('click', onCell);
    g.appendChild(c);
  }
}

function onCell(e) {
  const cells = document.querySelectorAll('.gcell');
  const idx = parseInt(e.currentTarget.dataset.i);
  if (gridTool === 'wall') {
    const c = cells[idx];
    if (!c.classList.contains('pc') && !c.classList.contains('npc')) {
      if (c.classList.contains('wall')) {
        c.textContent = ''; c.classList.remove('wall');
      } else {
        c.textContent = '▪'; c.classList.add('wall');
      }
    }
    return;
  }
  if (gridTool === 'move') {
    if (sel !== null) {
      const from = cells[sel], to = cells[idx];
      if (!to.classList.contains('wall') && !to.classList.contains('pc') && !to.classList.contains('npc')) {
        to.textContent = from.textContent;
        to.className = from.className;
        to.classList.remove('sel');
        from.textContent = ''; from.className = 'gcell';
      }
      cells[sel].classList.remove('sel');
      sel = null;
    } else {
      const c = cells[idx];
      if (c.textContent && !c.classList.contains('wall')) {
        sel = idx; c.classList.add('sel');
      }
    }
  }
}

function setTool(btn, t) {
  gridTool = t; sel = null;
  document.querySelectorAll('.gcell').forEach(c => c.classList.remove('sel'));
  document.querySelectorAll('.gt-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}
function clearGrid() {
  if (confirm('Clear all tokens?')) { Object.keys(TOKENS).forEach(k=>delete TOKENS[k]); buildGrid(); }
}

/* ── Initiative ─────────────────────────────────────────── */
let curInit = document.querySelector ? null : null;
function selectInit(el) {
  document.querySelectorAll('.init-row').forEach(r=>r.classList.remove('on'));
  el.classList.add('on');
  curInit = el;
}
function nextInit() {
  const rows = [...document.querySelectorAll('.init-row')];
  const idx = rows.indexOf(curInit ?? rows[0]);
  const next = rows[(idx+1) % rows.length];
  selectInit(next);
  next.scrollIntoView({block:'nearest',behavior:'smooth'});
}
function addInit() {
  const name = prompt('Combatant name:'); if (!name) return;
  const roll = Math.floor(Math.random()*20)+1;
  const isEnemy = /orc|troll|goblin|beholder|undead|wraith|golem/i.test(name);
  const list = document.getElementById('initList');
  const row = document.createElement('div');
  row.className = 'init-row' + (isEnemy?' enemy':'');
  const num = list.querySelectorAll('.init-row').length + 1;
  row.innerHTML = `<span class="init-num">${num}</span><span class="init-roll">${roll}</span><span class="init-name">${name}</span><span class="init-dot ${isEnemy?'dot-red':'dot-green'}"></span>`;
  row.addEventListener('click', ()=>selectInit(row));
  // insert by roll
  const existing = [...list.querySelectorAll('.init-row')];
  let inserted = false;
  for (const el of existing) {
    if (roll > parseInt(el.querySelector('.init-roll').textContent)) {
      list.insertBefore(row, el); inserted=true; break;
    }
  }
  if (!inserted) list.appendChild(row);
}
function endCombat() {
  if (confirm('End combat and clear initiative?')) {
    document.getElementById('initList').innerHTML =
      '<div class="init-empty">— No active encounter —</div>';
    curInit = null;
  }
}

/* ── Spell pips ─────────────────────────────────────────── */
document.querySelectorAll('.pip').forEach(p=>p.addEventListener('click',()=>p.classList.toggle('spent')));

/* ── Notes ──────────────────────────────────────────────── */
const nta = document.getElementById('notesTA');
const saved = localStorage.getItem('gm_notes_v2');
if (saved) nta.value = saved;
function saveNotes(btn) {
  localStorage.setItem('gm_notes_v2', nta.value);
  btn.textContent = 'Saved ✓';
  setTimeout(()=>btn.textContent='Save', 1600);
}
function insertTag(tag) {
  nta.value += '\n' + tag + ' ';
  nta.focus();
}

/* ── Tools ──────────────────────────────────────────────── */
function rollDice(n) {
  const r = Math.floor(Math.random()*n)+1;
  const msg = r===n ? `NATURAL ${n}!` : r===1 ? 'Critical Fail!' : `Result: ${r}`;
  alert(`d${n} → ${msg}`);
}
function applyDamage() {
  const dmg = prompt('Damage amount:');
  if (dmg && !isNaN(dmg)) alert(`${dmg} damage applied.`);
}

/* ── Footer nav ─────────────────────────────────────────── */
document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('on'));
    btn.classList.add('on');
  });
});

/* ── Init ───────────────────────────────────────────────── */
buildGrid();
curInit = document.querySelector('.init-row.on');
</script>
</body>
</html>
