# Optional: run API + Redis (for async clone when CELERY_BROKER_URL is set).
# Start API only: docker compose up app
# With Celery worker: set CELERY_BROKER_URL in app env and run worker separately:
#   docker compose run --rm -e CELERY_BROKER_URL=redis://redis:6379/0 app celery -A celery_app worker --loglevel=info
services:
  app:
    build: .
    ports:
      - "7862:7862"
    environment:
      - PORT=7862
      - SERVER_NAME=0.0.0.0
      # Optional: CELERY_BROKER_URL=redis://redis:6379/0
      # Optional: DATABASE_URL, VOICE_STORAGE_BACKEND, API_KEYS, etc.
    volumes:
      - voice_storage:/app/voice_storage
    # Uncomment to use Redis for async clone/narrate:
    # env_file: .env
    # depends_on: [redis]

  redis:
    image: redis:7-alpine
    # Only needed when using Celery
    profiles:
      - celery

volumes:
  voice_storage: {}
